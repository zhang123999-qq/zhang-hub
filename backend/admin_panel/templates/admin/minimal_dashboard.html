{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
<style>
.minimal-dashboard {
    padding: 20px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-card h3 {
    margin-top: 0;
    color: #666;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.stat-number {
    font-size: 36px;
    font-weight: bold;
    margin: 10px 0;
    color: #333;
}

.stat-change {
    font-size: 14px;
    color: #4CAF50;
}

.recent-list {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.recent-list h2 {
    margin-top: 0;
    border-bottom: 2px solid #f0f0f0;
    padding-bottom: 10px;
}

.recent-item {
    padding: 10px 0;
    border-bottom: 1px solid #f5f5f5;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.recent-item:last-child {
    border-bottom: none;
}

.quick-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.quick-action-btn {
    display: block;
    padding: 15px;
    background: #4CAF50;
    color: white;
    text-align: center;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
    transition: background 0.3s;
}

.quick-action-btn:hover {
    background: #45a049;
    color: white;
    text-decoration: none;
}

.status-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
}

.status-published { background: #4CAF50; color: white; }
.status-draft { background: #ff9800; color: white; }
</style>
{% endblock %}

{% block content %}
<div class="minimal-dashboard">
    <h1>ğŸ“Š ç³»ç»Ÿæ¦‚è§ˆ</h1>
    
    <!-- å¿«é€Ÿæ“ä½œ -->
    <div class="quick-actions">
        <a href="/admin/users/user/add/" class="quick-action-btn">ğŸ‘¤ æ·»åŠ ç”¨æˆ·</a>
        <a href="/admin/blog/article/add/" class="quick-action-btn">âœï¸ å†™æ–‡ç« </a>
        <a href="/admin/forum/post/add/" class="quick-action-btn">ğŸ’¬ å‘å¸–å­</a>
        <a href="#" class="quick-action-btn">ğŸ“¤ å¯¼å‡ºæ•°æ®</a>
    </div>
    
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-grid">
        <div class="stat-card">
            <h3>æ€»ç”¨æˆ·æ•°</h3>
            <div class="stat-number">{{ user_count }}</div>
            <div class="stat-change">ä»Šæ—¥æ–°å¢ï¼š{{ today_users|default:0 }}</div>
        </div>
        
        <div class="stat-card">
            <h3>æ–‡ç« æ€»æ•°</h3>
            <div class="stat-number">{{ article_count }}</div>
            <div class="stat-change">æœ¬å‘¨æ–°å¢ï¼š{{ week_articles }}</div>
        </div>
        
        <div class="stat-card">
            <h3>æ´»è·ƒè®¨è®º</h3>
            <div class="stat-number">{{ comment_count|default:0 }}</div>
            <div class="stat-change">ä»Šæ—¥ï¼š{{ today_comments|default:0 }}</div>
        </div>
        
        <div class="stat-card">
            <h3>å®‰å…¨èµ„æº</h3>
            <div class="stat-number">{{ resource_count|default:0 }}</div>
            <div class="stat-change">å·¥å…·ï¼š{{ tool_count|default:0 }}</div>
        </div>
    </div>
    
    <!-- è¿‘æœŸå†…å®¹ -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div class="recent-list">
            <h2>ğŸ‘¥ æœ€è¿‘æ³¨å†Œç”¨æˆ·</h2>
            {% for user in recent_users %}
            <div class="recent-item">
                <div>
                    <strong>{{ user.username }}</strong>
                    <div style="font-size: 12px; color: #666;">
                        {{ user.email }} Â· {{ user.date_joined|date:"Y-m-d" }}
                    </div>
                </div>
                <span class="status-badge status-{{ user.role }}">
                    {{ user.get_role_display }}
                </span>
            </div>
            {% endfor %}
        </div>
        
        <div class="recent-list">
            <h2>ğŸ“ æœ€æ–°æ–‡ç« </h2>
            {% for article in recent_articles %}
            <div class="recent-item">
                <div>
                    <strong>{{ article.title|truncatechars:30 }}</strong>
                    <div style="font-size: 12px; color: #666;">
                        ä½œè€…ï¼š{{ article.author.username }} Â· {{ article.created_at|date:"Y-m-d" }}
                    </div>
                </div>
                <span class="status-badge status-{{ article.status }}">
                    {{ article.get_status_display }}
                </span>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <!-- å¿«é€Ÿç»Ÿè®¡ -->
    <div style="margin-top: 30px; text-align: center;">
        <button id="refresh-stats" class="quick-action-btn" style="background: #2196F3;">
            ğŸ”„ åˆ·æ–°ç»Ÿè®¡æ•°æ®
        </button>
    </div>
</div>

<script>
document.getElementById('refresh-stats').addEventListener('click', function() {
    fetch('/admin/quick-stats/')
        .then(response => response.json())
        .then(data => {
            alert('ç»Ÿè®¡æ•°æ®å·²åˆ·æ–°ï¼');
            location.reload();
        });
});

// è‡ªåŠ¨åˆ·æ–°æ¯5åˆ†é’Ÿ
setTimeout(() => {
    location.reload();
}, 300000);
</script>
{% endblock %}
